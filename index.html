<!DOCTYPE html>
<html>

<head>
    <title>QRaid Boss</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="css/mainForm.css">
</head>

<body>
    <div>
        <label for="currentRaidboss">Current Raid Boss: </label>
        <input oninput="setRaidboss()" type="text" id="currentRaidboss" />
    </div>
    <div>
        <label for="locations">Location: </label>
        <input list="locations" id="location" onclick="reset()">
        <datalist id="locations">
        </datalist>
    </div>
    </div>
    <label for="hatchTime">Egg Hatch Time: </label>
    <input type="time" id="hatchTime" min="04:00" max="00:00">
    </div>
    <div>
        <label for="number">Minutes to start after egg hatch: </label>
        <input type="number" id="startTime" value="35" max="1000" />
    </div>
    <div>
        <button id="createMessage" onclick="CreateMessage()">Do Magic</button>
    </div>
    <div>
        <label for="result">Result: </label>
        <textarea id="result" rows="2" readonly contenteditable="false"></textarea>
    </div>
    <div>
        <button id="copy" onclick="copy()">Copy to Clipboard</button>
    </div>
    <div>
        <button id="share" onclick="share()">Share</button>
    </div>
</body>

</html>

<script>
    const version = "0.1.1";
    if (!localStorage.getItem("currentVersion")) {
        localStorage.setItem("currentVersion", version);
    } else if (localStorage.getItem("currentVersion") != version) {
        localStorage.removeItem("currentRaidBoss");
        localStorage.setItem("currentVersion", version);
    }
</script>

<script>
    var CurrentRaidBoss = "Giratina Altered Forme";
    if (!localStorage.getItem("currentRaidBoss")) {
        localStorage.setItem("currentRaidBoss", CurrentRaidBoss);
        document.getElementById("currentRaidboss").value = localStorage.getItem("currentRaidBoss");
    } else {
        document.getElementById("currentRaidboss").value = localStorage.getItem("currentRaidBoss");
    }

    var d = new Date(),
        h = d.getHours(),
        m = d.getMinutes();
    if (h < 10) h = '0' + h;
    if (m < 10) m = '0' + m;
    document.getElementById("hatchTime").value = `${h}:${m}`;;
</script>

<script>
    function setRaidboss() {
        localStorage.setItem("currentRaidBoss", document.getElementById("currentRaidboss").value);
    }

    function share() {
        if (document.getElementById("result").value != "")
            location.href = "whatsapp://send?text=" + encodeURIComponent(document.getElementById("result").value);
    }

    function reset() {
        document.getElementById("location").value = "";
    }

    function copy() {
        var el = document.getElementById("result");
        // resolve the element
        el = (typeof el === 'string') ? document.querySelector(el) : el;

        // handle iOS as a special case
        if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {

            // save current contentEditable/readOnly status
            var editable = el.contentEditable;
            var readOnly = el.readOnly;

            // convert to editable with readonly to stop iOS keyboard opening
            el.contentEditable = true;
            el.readOnly = true;

            // create a selectable range
            var range = document.createRange();
            range.selectNodeContents(el);

            // select the range
            var selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            el.setSelectionRange(0, 999999);

            // restore contentEditable/readOnly to original state
            el.contentEditable = editable;
            el.readOnly = readOnly;
        } else {
            el.select();
        }

        // execute copy command
        document.execCommand('copy');
    }

    function CreateMessage() {
        if (document.getElementById("startTime").value == "" || document.getElementById("hatchTime").value == "") {
            return;
        } else if (document.getElementById("location").value == "") {
            alert("No location entered");
            return;
        }
        var hatchTime = document.getElementById("hatchTime").value;
        var hatchDate = new Date(`0`);
        hatchDate.setHours(parseInt(hatchTime.split(":")[0]));
        hatchDate.setMinutes(parseInt(hatchTime.split(":")[1]));

        var msg = Construct(document.getElementById("location").value, hatchDate, parseInt(document.getElementById("startTime").value));
        if (!msg) {
            alert("Invalid location");
            return;
        }
        document.getElementById("result").value = msg
        document.getElementById("result").style.height = document.getElementById("result").scrollHeight + "px";
    }

    function fixTime(i) {
        var d = i,
            h = i.getHours(),
            m = i.getMinutes();
        if (h < 10) h = '0' + h;
        if (m < 10) m = '0' + m;
        return `${h}.${m}`;
    }

    function Construct(location, raidAvailableTime, addMin) {
        if (RaidLocations.filter(s => s.name == location).length <= 0)
            return false;

        var targetLocation = RaidLocations.find(s => s.name == location);
        var endTime = new Date(raidAvailableTime.getTime() + 45 * 60000);
        var startTime = new Date(raidAvailableTime.getTime() + addMin * 60000);

        var message = `*${localStorage.getItem("currentRaidBoss")}* _${targetLocation.name}_${targetLocation.exraid == true ? " *EX RAID LOCATIE*" : ""}
*Locatie* ${targetLocation.location}
*Raidboss Available* ${fixTime(raidAvailableTime)} - ${fixTime(endTime)}
*Start* ${fixTime(startTime)}
*Voor Deelname* ${targetLocation.reaction}
*Deelnemers*`;
        return message;
    }
</script>

<script>
    //Set raidlocations
    var RaidLocations = [{
        name: "Langeleenweg Tunnel √ài√® mural",
        location: "Fietsers tunnel bij de Gamma (Bossenburg)",
        reaction: "üõπ",
        exraid: false
    }, {
        name: "Skatebaan Bossenburgh",
        location: "Bossenburgh, bij CSW en Scheldemond",
        reaction: "üõ£",
        exraid: true
    }, {
        name: "Graffiti skatebaan Bossenburgh",
        location: "Bossenburgh, bij CSW en Scheldemond",
        reaction: "üë©üèª‚Äçüé®",
        exraid: false
    }, {
        name: "Apostolische gemeenschap",
        location: "Lammerenburg/Rosenburg",
        reaction: "üèö",
        exraid: false
    }, {
        name: "Speel waar het kan en mag",
        location: "Bossenburgh",
        reaction: "üéÆ",
        exraid: false
    }, {
        name: "Blijdier Saar",
        location: "Nieuw Bonedijkelaan ",
        reaction: "‚≠ï",
        exraid: false
    }, {
        name: "Buizen in het gras",
        location: "Rosenburglaan",
        reaction: "ü¶ó",
        exraid: false
    }, {
        name: "Playground Lammerenburg",
        location: "Strandwal",
        reaction: "‚ñ∂",
        exraid: false
    }, {
        name: "Mural House",
        location: "Kanariesprenk/Papegaaienburg",
        reaction: "üè°",
        exraid: false
    }, {
        name: "Metal Papegaaienburg",
        location: "Kanariesprenk",
        reaction: "ü§ñ",
        exraid: false
    }, {
        name: "Weyevliet Mural",
        location: "Weyevlietpad",
        reaction: "üë£",
        exraid: false
    }, {
        name: "One Wish and a very big Fish",
        location: "President Rooseveltlaan",
        reaction: "üê†",
        exraid: true
    }, {
        name: "Scheve blokken",
        location: "Van Dycklaan",
        reaction: "üëí",
        exraid: true
    }, {
        name: "Straat Moza√Øek",
        location: "Gravestraat",
        reaction: "üë∫",
        exraid: false
    }, {
        name: "Vuurtoren/Michieltje",
        location: "Boule",
        reaction: "‚öì",
        exraid: false
    }, {
        name: "700 Jaar Vlissingen/Timmerfabriek",
        location: "Koningsweg",
        reaction: "üíï",
        exraid: false
    }, {
        name: "Graffiti",
        location: "President Rooseveltlaan",
        reaction: "üéÉ",
        exraid: false
    }, {
        name: "Balans/Ter Reede",
        location: "Koudekerkseweg",
        reaction: "üëµüèª",
        exraid: false
    }, {
        name: "Nieuw Apostolische Kerk",
        location: "West Souburg",
        reaction: "‚õ™",
        exraid: false
    }, {
        name: "Kruis Kerk de Schaapskooi ",
        location: "Winkelcentrum Papegaaienburg",
        reaction: "üêë",
        exraid: false
    }, {
        name: "Souburg City Windwill",
        location: "Kanaalstraat",
        reaction: "üê∂",
        exraid: false
    }, {
        name: "Flying Dutchman",
        location: "Stadhuisplein",
        reaction: "üá≥üá±",
        exraid: false
    }, {
        name: "Badeend Moza√Øek",
        location: "Nieuw Bonedijkelaan",
        reaction: "‚ùå",
        exraid: true
    }, {
        name: "Papegaai in Glas",
        location: "Papegaaienburg",
        reaction: "ü¶ú",
        exraid: false
    }, {
        name: "Speelplastiek",
        location: "Aletta Jacobslaan",
        reaction: "üêù", //DUPLICATE
        exraid: true
    }, {
        name: "Kleurige Tegels 2",
        location: "Adriaen Coortelaan",
        reaction: "ü•≥",
        exraid: false
    }, {
        name: "Standbeelden Bambini",
        location: "Bambini",
        reaction: "üå¥",
        exraid: false
    }, {
        name: "Fire eyes",
        location: "Cirkel Paauwenburg",
        reaction: "üôÉ", //ü§©
        exraid: false
    }, {
        name: "Statue Frans Naerebout",
        location: "Boule",
        reaction: "üß¶", //DUPLICATE
        exraid: false
    }, {
        name: "Adventkerk",
        location: "Kerklaan, West-Souburg",
        reaction: "üß¢",
        exraid: false
    }, {
        name: "Familie Pilaar",
        location: "Groen van prinksterenlaan",
        reaction: "ü§Ø",
        exraid: true
    }, {
        name: "Speelplaats het Fort",
        location: "Pieter Poststraat",
        reaction: "üñ§",
        exraid: false
    }, {
        name: "Las Vegas",
        location: "Bloemenlaan/Singel",
        reaction: "üíã",
        exraid: false
    }, {
        name: "Boeiend/Bioscoop",
        location: "Spuikomweg",
        reaction: "üéû",
        exraid: false
    }, {
        name: "Fysiotherapie",
        location: "Burgemeester van Woelderenlaan",
        reaction: "üßòüèª",
        exraid: false
    }, {
        name: "The Watertower",
        location: "Badhuisstraat",
        reaction: "üíß",
        exraid: false
    }, {
        name: "Spider's Web Playground",
        location: "Westerzicht",
        reaction: "üï∏",
        exraid: false
    }, ];
</script>


<script>
    for (var i of RaidLocations) {
        var option = document.createElement('option');
        option.value = i.name;
        document.getElementById('locations').appendChild(option);
    }
</script>